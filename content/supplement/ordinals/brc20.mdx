---
title: Brc20
---

`Brc20` 数据存储基于 `Taproot`, 数据存储在脚本树的节点中。

<ScaleableImage
  src='/inscription-taptree.png'
  alt='taproot-out-explain'
/>

由随机生成密钥, 计算出公钥的 $X$ 坐标作为内部公钥。结合脚本树的 $t$ 值, 计算出 `Taproot` 输出公钥 $Q$ 。`bech32m` 编码后得到 `Taproot` 地址。

当向该地址转账时, 会得到一个 `UTXO`, 其锁定脚本为 `OP_1 <Taproot 输出公钥>`, 类型为 `P2TR`。但是, 该 `UTXO` 并没有包含任何 `Brc20` 的数据。而要使 `Brc20` 数据显式存储在链上, 必须要同时花费该 `UTXO`。并且花费路径只能选择脚本路径, 因为脚本路径花费时需要提供要花费脚本的完整数据, 如此便实现数据链上存储。

故 `Brc20` 交易都需要包含两笔交易:

- 第一笔交易称作 `commit` 交易, 用于向生成的 `Taproot` 地址转账
- 第二笔交易称作 `reveal` 交易, 用于花费 `commit` 交易生成的 `UTXO`

:::note

向生成的 `Taproot` 地址转账时, 需要转账足够的聪。避免花费时因为交易费不足导致的交易无法确认。

:::

## 计算 Taproot 地址

<Brc20Pub />

随机生成的内部秘钥对用于生成临时的 `Taproot` 地址

## Commit 交易

生成 `Taproot` 地址后, 需要向该地址转账。即花费自己可解锁的 `UTXO` 向 `Taproot` 地址转账。转账金额需要根据当前比特币网络的费率确定。

两笔交易

Commit: https://mempool.space/tx/26877b8e3d64a8688ba01f7fa62c26e2b4f4034dfb44029246c92643b2f1a93b
Reveal: https://mempool.space/tx/00274fdd890873da479a51896f328665a71d2f3c1dff00fbb20155e9fcda2c50

testnet:

tx1 commit: https://mempool.space/testnet/tx/50c2a1e54f305426d0fcc47caa8f07322ac149838aa27912343503080bc221b0
tx2 reveal: https://mempool.space/testnet/tx/ea58f831e9d532bab8985e94def57a3e2c992e8018f80c11a81f5dfcd643a42c

tx2 commit: https://mempool.space/testnet/tx/a4813cd17b2fefd618f54af6d2849de245ced9950c1b8ee06fab628412e936d4
tx2 reveal: https://mempool.space/testnet/tx/b159d03058115115b209b4dbff51d75175225320349762011fdefda66a3cbe2d

Commit Tx to P2tr address with scripttree

tapScript:

```text
OP_PUSHBYTES_32 521c70a059f55a3518489ce12f6b56902cd55e9f0a2f0b5dc0614f6a1dc49a79  # 推入公钥
OP_CHECKSIG                                                                        # 检查签名

# 铭文数据部分
OP_0                                                                  # OP_FALSE
OP_IF                                                                # 开始条件块
    OP_PUSHBYTES_3 6f7264                                           # "ord"
    OP_PUSHBYTES_1 01
    OP_PUSHBYTES_24 746578742f706c61696e3b636861727365743d7574662d38  # "text/plain;charset=utf-8"
    OP_0
    OP_PUSHBYTES_57 7b2270223a...                                   # BRC-20
OP_ENDIF
```

## Reveal 交易

## 索引器
